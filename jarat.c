#include <stdlib.h>#include <stdio.h>#include <string.h>#include <unistd.h>#include <stdbool.h>#include "jarat.h"#include "utas.h"#include "menu.h"#include "debugmalloc.h"void jaratBeolvas() {    if (jaratListaEleje != NULL) jaratFelszabadit(jaratListaEleje);    jaratListaEleje = NULL;    char sor[100];    FILE *fp;    char jaratSz[100], indHely[100], erkHely[100], indDatum[100], indIod[100], erkDatum[100], erkIdo[100];    if (access("jaratok.txt", F_OK) != 0) {        fp = fopen("jaratok.txt","w");        fclose(fp);    }    if ((fp = fopen("jaratok.txt", "r")) == NULL) {        printf("Error! opening file");    }    while (fscanf(fp, "%s", sor) != EOF) {        Jarat jarat;        sscanf(sor, "%[^;];%[^;];%[^;];%[^;];%[^;];%[^;];%[^\n]", jaratSz, indHely, erkHely, indDatum, indIod,               erkDatum, erkIdo);        strcpy(jarat.jaratSzam, jaratSz);        strcpy(jarat.indulasiHely, indHely);        strcpy(jarat.erkezesiHely, erkHely);        strcpy(jarat.indulasiDatum, indDatum);        strcpy(jarat.indulasiIdo, indIod);        strcpy(jarat.erkezesiDatum, erkDatum);        strcpy(jarat.erkezesiIdo, erkIdo);        jaratListaEleje = jaratHozzaad(jaratListaEleje, jarat);    }    fclose(fp);}JaratLista *jaratHozzaad(JaratLista *eleje, Jarat adat) {    char fileName[100];    strcpy(fileName, adat.jaratSzam);    strcat(fileName, ".txt");    FILE *fp;    if (access(fileName, F_OK) != 0) {        fp = fopen(fileName,"w");        fclose(fp);    }    JaratLista *uj;    uj = (JaratLista*) malloc(sizeof(JaratLista));    uj->adat = adat;    uj->kov = NULL;    if (eleje == NULL) {        eleje = uj;    } else {        JaratLista *mozgo = eleje;        while (mozgo->kov != NULL)            mozgo = mozgo->kov;        mozgo->kov = uj;        uj->kov = NULL;    }    return eleje;}JaratLista *jaratTorlese(JaratLista *eleje, char *jarat) {    JaratLista *lemarado = NULL;    JaratLista *mozgo = eleje;    while (mozgo != NULL && strcmp(mozgo->adat.jaratSzam, jarat) != 0) {        lemarado = mozgo;        mozgo = mozgo->kov;    }    if (mozgo == NULL) {    } else if (lemarado == NULL) {        JaratLista *ujeleje = mozgo->kov;        free(mozgo);        eleje = ujeleje;    } else {        lemarado->kov = mozgo->kov;        free(mozgo);    }    return eleje;}void modositJaratszam(JaratLista *eleje, char *ujJaratszam, char *regiJaratszam) {    JaratLista *iter;    for (iter = eleje; iter != NULL; iter = (JaratLista *) iter->kov) {        if (strcmp(iter->adat.jaratSzam, regiJaratszam) == 0) {            strcpy(iter->adat.jaratSzam, ujJaratszam);            break;        }    }}void modositIndulasihely(JaratLista *eleje, char *jaratSzam, char *ujHely) {    JaratLista *iter;    for (iter = eleje; iter != NULL; iter = (JaratLista *) iter->kov) {        if (strcmp(iter->adat.jaratSzam, jaratSzam) == 0) {            strcpy(iter->adat.indulasiHely, ujHely);            break;        }    }}void modositErkezesihely(JaratLista *eleje, char *jaratSzam, char *ujHely) {    JaratLista *iter;    for (iter = eleje; iter != NULL; iter = (JaratLista *) iter->kov) {        if (strcmp(iter->adat.jaratSzam, jaratSzam) == 0) {            strcpy(iter->adat.erkezesiHely, ujHely);            break;        }    }}void modositIndulasiIdo(JaratLista *eleje, char *jaratSzam, char *ujDatum, char *ujIdo) {    JaratLista *iter;    for (iter = eleje; iter != NULL; iter = (JaratLista *) iter->kov) {        if (strcmp(iter->adat.jaratSzam, jaratSzam) == 0) {            strcpy(iter->adat.indulasiDatum, ujDatum);            strcpy(iter->adat.indulasiIdo, ujIdo);            break;        }    }}void modositErkezesiIdo(JaratLista *eleje, char *jaratSzam, char *ujDatum, char *ujIdo) {    JaratLista *iter;    for (iter = eleje; iter != NULL; iter = (JaratLista *) iter->kov) {        if (strcmp(iter->adat.jaratSzam, jaratSzam) == 0) {            strcpy(iter->adat.erkezesiDatum, ujDatum);            strcpy(iter->adat.erkezesiIdo, ujIdo);            break;        }    }}void jaratFileUjrair(JaratLista *eleje) {    int szamol = 0;    JaratLista *iter;    FILE *fp;    fp = fopen("jaratok.txt", "w");    for (iter = eleje; iter != NULL; iter = iter->kov) {        Jarat j = iter->adat;        fprintf(fp, "%s;%s;%s;%s;%s;%s;%s", j.jaratSzam, j.indulasiHely, j.erkezesiHely, j.indulasiDatum, j        .indulasiIdo, j.erkezesiDatum, j.erkezesiIdo);        szamol++;    }    fclose(fp);}void jaratFelszabadit(JaratLista *eleje) {    JaratLista *iter = eleje;    while (iter != NULL) {        JaratLista *kov = iter->kov;        free(iter);        iter = kov;    }}void keresIndErkPoint(JaratLista *eleje, char *indulasi, char *erkezesi) {    JaratLista *iter;    bool t = false;    for (iter = eleje; iter != NULL; iter = iter->kov) {        if (strcmp(iter->adat.indulasiHely, indulasi) == 0        && strcmp(iter->adat.erkezesiHely, erkezesi) == 0) {            printf("%s\t%s %s\t%s %s\n", iter->adat.jaratSzam, iter->adat.erkezesiDatum, iter->adat.indulasiIdo,                   iter->adat.erkezesiDatum, iter->adat.erkezesiIdo);            t = true;        }    }    if (t) {        keresJaratSz();    } else {        printf("Nincs talalat");        menu();    };}void foglaltsagiTerkep() {    char c[4];    char *tomb[150];    int idx = 0;    for (int i = 1; i <= 25; ++i) {        for (char j = 'A'; j <= 'F'; ++j) {            char *p;            sprintf(c, "%d%c", i,j);            p = strdup(c);            tomb[idx++] = p;        }    }    printf("\n---------------------------------------------------\n");    int sz = 1;    for (int i = 0; i < 150; ++i) {        if (i < 54) {            printf("| 0%s |\t", tomb[i]);        } else {            printf("| %s |\t", tomb[i]);        }        if (sz == 3)            printf("\t");        if (sz == 6) {            printf("\n");            for (int j = 5; j >= 0; --j) {                printf("|  %c  |\t", foglaltE(utasListaEleje, tomb[i -j]) ? 'X' : 'S');                if (j == 3) {                    printf("\t");                }            }            if (i < 148) {                printf("\n|---------------------|     |---------------------|\n");            }            sz = 0;        }        sz++;    }    printf("\n---------------------------------------------------\n");}void menuTerkep() {    char c[4];    char *tomb[150];    int idx = 0;    for (int i = 1; i <= 25; ++i) {        for (char j = 'A'; j <= 'F'; ++j) {            char *p;            sprintf(c, "%d%c", i,j);            p = strdup(c);            tomb[idx++] = p;        }    }    printf("\n---------------------------------------------------\n");    int sz = 1;    for (int i = 0; i < 150; ++i) {        if (i < 54) {            printf("| 0%s |\t", tomb[i]);        } else {            printf("| %s |\t", tomb[i]);        }        if (sz == 3)            printf("\t");        if (sz == 6) {            printf("\n");            for (int j = 5; j >= 0; --j) {                printf("|  %c  |\t", milyenMenu(utasListaEleje, tomb[i-j]));                if (j == 3) {                    printf("\t");                }            }            if (i < 148) {                printf("\n|---------------------|     |---------------------|\n");            }            sz = 0;        }        sz++;    }    printf("\n---------------------------------------------------\n");}bool vanEJarat(JaratLista *eleje, char *jarat) {    JaratLista *iter;    for (iter = eleje; iter != NULL; iter = iter->kov) {        if (strcmp(iter->adat.jaratSzam, jarat) == 0) return true;    }    return false;}